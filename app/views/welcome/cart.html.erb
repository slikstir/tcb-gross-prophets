<% if @cart.blank? || @cart.try(:line_items).blank? %>
  <div class="container mt-5 mb-5">
    <!-- Cart Header -->
    <div class="col-md-6 mx-auto">
      <h2 class="mb-5">Your Cart is Empty</h2>
      <%= link_to "Continue Shopping", shop_path, class: "btn btn-lg btn-outline-warning w-100" %>
    </div>
<% else %>
  <div class="container mt-5 mb-5">
    <!-- Cart Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>Your Cart</h2>
      <%= link_to "Continue Shopping", shop_path, class: "btn btn-outline-warning" %>
    </div>

    <!-- Cart Table -->
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th style="width: 100px">Product</th>
            <th></th>
            <th style="width: 200px">Quantity</th>
            <th class="text-end">Total</th>
          </tr>
        </thead>
        <tbody>
          <% @cart.line_items.each do |item| %>
            <tr>
              <!-- Product Image -->
              <td>
                <% if item.product.image.attached? %>
                  <%= image_tag item.product.image, class: "img-fluid rounded", style: "max-width: 80px; height: auto;" %>
                <% else %>
                  <%= image_tag "placeholder.jpg", class: "img-fluid rounded", style: "max-width: 80px; height: auto;" %>
                <% end %>
              </td>

              <!-- Product Name & Price -->
              <td class="text-start">
                <strong><%= item.product.name %></strong><br>
                <% item.variant.options.each do |option, val| %>
                  <strong><%= option %>:</strong> <%= val %><br>
                <% end %>
                <span class="text-muted">
                  <%= number_to_currency(item.product.price) %><br>
                  <% if item.performer.present? %> 
                    <strong>Commission Earned By:</strong><br><%= item.performer.name %>
                  <% end %>
                </span>
              </td>

              <!-- Quantity Controls -->
              <td>
                <div class="d-flex align-items-center">
                  <%= button_to "-", line_item_path(item.id, line_item: {quantity: item.quantity - 1}), method: :patch, class: "btn btn-outline-secondary btn-sm me-2" %>
                  <span class="px-3"><%= item.quantity %></span>
                  <%= button_to "+", line_item_path(item.id,  line_item: {quantity: item.quantity + 1}), method: :patch, class: "btn btn-outline-secondary btn-sm ms-2" %>
                  <%= button_to line_item_path(item.id), method: :delete, class: "btn btn-danger btn-sm ms-3" do  %>
                    <%= icon 'trash', class: 'icon-text-white' %>
                  <% end %>
                </div>
              </td>

              <!-- Item Subtotal -->
              <td class="text-end">
                <%= number_to_currency(item.total_price) %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <!-- Cart Footer -->
    <div class="d-flex justify-content-end mt-4">
      <div class="text-end">
        <% if @cart.tax_rate > 0.0 %>
          <h5 class="mb-3 text-muted">Subotal: <%= number_to_currency(@cart.subtotal) %></h5>
          <h5 class="mb-3 text-muted">Tax: <%= number_to_currency(@cart.tax_total) %></h5>
        <% end %>
        <h4 class="mb-3">Total: <%= number_to_currency(@cart.total) %></h4>
        <%= link_to "Check Out", "#", class: "btn btn-warning btn-lg" %>
      </div>
    </div>

<% end %>
